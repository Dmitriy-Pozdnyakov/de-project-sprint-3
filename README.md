# Проект 3-го спринта

### Описание
Репозиторий предназначен для сдачи проекта 3-го спринта

### Структура репозитория
1. В папке `src` хранятся все необходимые исходники: 
* src\database_de_init: *dump_de_shema.sql* - восстанавливает схему БД, *mart.d_calendar* - наполняет таблицу календарь данными
* src\dags - содержит DAG's Airflow: *sales_daily_increment.py* - обновляет базу данных инкрементом за вчера, *sales_period_increment.py* - обновляет бд инкрементами за определенный период

2. Папка `migrations` хранит файлы миграции:
* mart.f_customer_retention.sql - предназначен для создания ddl - макета новой аналитической витрины
* staging.user_order_log.sql - добавляет новое поле status в таблицу *staging.user_order_log.sql*


## Задание 1
Адаптирован пайплайн и модель данных с учетом появления новых данных о статусе заказа и backward compatibility.
* перед запуском DAG-файлов необходимо запустить скприпты из папки `migrations`
* Запуск DAG_1 - >> *sales_daily_increment.py* - обновляет базу данных инкрементом за вчера на ежедневной основе

## Задание 2
Реализована витрина данных: *mart.f_customer_retention* благодаря ей можно будет выяснить, какие категории товаров лучше всего удерживают клиентов.

1. new_customers_count — кол-во новых клиентов (тех, которые сделали только один 
заказ за рассматриваемый промежуток времени).
2. returning_customers_count — кол-во вернувшихся клиентов (тех,
которые сделали только несколько заказов за рассматриваемый промежуток времени).
3. refunded_customer_count — кол-во клиентов, оформивших возврат за 
рассматриваемый промежуток времени.
4. period_name — weekly.
5. period_id — идентификатор периода (номер недели или номер месяца).
6. item_id — идентификатор категории товара.
7. new_customers_revenue — доход с новых клиентов.
8. returning_customers_revenue — доход с вернувшихся клиентов.
9. customers_refunded — количество возвратов клиентов. 

## Задание 3
При повторной отработке отработке пайплайна в таблицах фактов схемы mart не возникает дублей за счет удаления инкремента и загрузкой новой порции данныхза дату обновления